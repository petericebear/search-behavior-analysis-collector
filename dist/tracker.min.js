(()=>{var e={140:e=>{class t{constructor(e={}){this.config={endpoint:e.endpoint||"/api/track",selector:e.selector||".trackable-item",dataAttribute:e.dataAttribute||"data-item-id",searchRequestIdAttribute:e.searchRequestIdAttribute||"data-search-request-id",sessionTimeout:e.sessionTimeout||18e5,batchSize:e.batchSize||10,sendInterval:e.sendInterval||1e4,sessionId:e.sessionId||null,searchRequestId:e.searchRequestId||null},this.events=[],this.sessionId=this.getOrCreateSessionId(),this.browserInfo=this.getBrowserInfo(),this.colorIdentifier=this.getOrCreateColorIdentifier(),this.utmParams=this.getUtmParameters(),this.setupEventListeners(),this.setupBatchSending(),this.setupPerformanceObserver(),setInterval((()=>this.checkSessionExpiration()),6e4)}getBrowserInfo(){const e=navigator.userAgent,t={userAgent:e,language:navigator.language,platform:navigator.platform,screenWidth:window.screen.width,screenHeight:window.screen.height,viewportWidth:window.innerWidth,viewportHeight:window.innerHeight,devicePixelRatio:window.devicePixelRatio,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:(new Date).toISOString(),connection:navigator.connection?{effectiveType:navigator.connection.effectiveType,downlink:navigator.connection.downlink,rtt:navigator.connection.rtt,saveData:navigator.connection.saveData}:null,memory:navigator.deviceMemory?{deviceMemory:navigator.deviceMemory,hardwareConcurrency:navigator.hardwareConcurrency}:null};return e.includes("Chrome")?t.browser="Chrome":e.includes("Firefox")?t.browser="Firefox":e.includes("Safari")?t.browser="Safari":e.includes("Edge")?t.browser="Edge":t.browser="Unknown",t}setupPerformanceObserver(){if("PerformanceObserver"in window){new PerformanceObserver((e=>{const t=e.getEntries(),n=t[t.length-1];this.trackEvent("performance_metric",{type:"LCP",value:n.startTime,element:n.element?.tagName||"unknown",size:n.size,url:n.url})})).observe({entryTypes:["largest-contentful-paint"]});new PerformanceObserver((e=>{const t=e.getEntries();this.trackEvent("performance_metric",{type:"FCP",value:t[0].startTime})})).observe({entryTypes:["paint"]});new PerformanceObserver((e=>{e.getEntries().forEach((e=>{this.trackEvent("performance_metric",{type:"FID",value:e.processingStart-e.startTime,name:e.name})}))})).observe({entryTypes:["first-input"]});new PerformanceObserver((e=>{let t=0;e.getEntries().forEach((e=>{e.hadRecentInput||(t+=e.value)})),this.trackEvent("performance_metric",{type:"CLS",value:t})})).observe({entryTypes:["layout-shift"]});new PerformanceObserver((e=>{e.getEntries().forEach((e=>{this.trackEvent("performance_metric",{type:"RESOURCE",name:e.name,duration:e.duration,size:e.transferSize,initiatorType:e.initiatorType})}))})).observe({entryTypes:["resource"]});const e=performance.getEntriesByType("navigation")[0];e&&this.trackEvent("performance_metric",{type:"NAVIGATION",ttfb:e.responseStart-e.requestStart,domContentLoaded:e.domContentLoadedEventEnd-e.startTime,load:e.loadEventEnd-e.startTime,dns:e.domainLookupEnd-e.domainLookupStart,tcp:e.connectEnd-e.connectStart,request:e.responseEnd-e.requestStart})}}getOrCreateSessionId(){if(this.config.sessionId)return localStorage.setItem("tracker_session_id",this.config.sessionId),localStorage.setItem("tracker_session_timestamp",(new Date).toISOString()),this.config.sessionId;const e=localStorage.getItem("tracker_session_id"),t=localStorage.getItem("tracker_session_timestamp");if(e&&t){if((new Date).getTime()-new Date(t).getTime()<this.config.sessionTimeout)return e}const n=this.generateUUID();return localStorage.setItem("tracker_session_id",n),localStorage.setItem("tracker_session_timestamp",(new Date).toISOString()),n}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}setupEventListeners(){document.addEventListener("click",(e=>{const t=e.target.closest(this.config.selector);if(t){const e=t.getAttribute(this.config.dataAttribute);if(e){const n=document.querySelectorAll(this.config.selector),s=Array.from(n).indexOf(t)+1,r=t.getAttribute(this.config.searchRequestIdAttribute)||this.config.searchRequestId;this.trackClick({itemId:e,position:s,searchRequestId:r,timestamp:(new Date).toISOString()})}}})),document.addEventListener("visibilitychange",(()=>{this.trackEvent("visibility_change",{state:document.visibilityState})})),window.addEventListener("beforeunload",(()=>{this.sendEvents(!0)}))}setupBatchSending(){setInterval((()=>{this.events.length>0&&this.sendEvents()}),this.config.sendInterval)}trackEvent(e,t={}){this.events.push({type:"custom_event",name:e,data:t,sessionId:this.sessionId,colorIdentifier:this.colorIdentifier,timestamp:(new Date).toISOString()}),this.events.length>=this.config.batchSize&&this.sendEvents()}trackClick(e){this.events.push({type:"click",...e,sessionId:this.sessionId,colorIdentifier:this.colorIdentifier}),this.events.length>=this.config.batchSize&&this.sendEvents()}async sendEvents(e=!1){if(0===this.events.length)return;const t=[...this.events];this.events=[];const n={events:t,sessionId:this.sessionId,colorIdentifier:this.colorIdentifier,browserInfo:this.browserInfo,utmParams:this.utmParams,timestamp:(new Date).toISOString()};try{if(e&&navigator.sendBeacon){if(!navigator.sendBeacon(this.config.endpoint,new Blob([JSON.stringify(n)],{type:"application/json"})))throw this.events=[...t,...this.events],new Error("Failed to send events via sendBeacon")}else{if(!(await fetch(this.config.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).ok)throw this.events=[...t,...this.events],new Error("Failed to send events")}}catch(e){console.error("Error sending events:",e),this.events=[...t,...this.events]}}resetSession(){localStorage.removeItem("tracker_session_id"),localStorage.removeItem("tracker_session_timestamp"),this.sessionId=this.getOrCreateSessionId()}checkSessionExpiration(){const e=localStorage.getItem("tracker_session_timestamp");if(e){(new Date).getTime()-new Date(e).getTime()>=this.config.sessionTimeout&&this.resetSession()}}trackConversion(e){this.trackEvent("conversion",e),this.resetSession()}getOrCreateColorIdentifier(){let e=localStorage.getItem("colorschema_identifier");if(!e){e=`${this.generateRandomColor()}-${this.generateRandomColor()}`,localStorage.setItem("colorschema_identifier",e)}return e}generateRandomColor(){let e="#";for(let t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}getUtmParameters(){const e=new URLSearchParams(window.location.search),t={};return["source","medium","campaign","term","content"].forEach((n=>{const s=e.get(`utm_${n}`);s&&(t[`utm_${n}`]=s)})),t}updateSearchRequestId(e){this.config.searchRequestId=e}}e.exports?e.exports=t:window.SearchBehaviorAnalysisCollector=t}},t={};(function n(s){var r=t[s];if(void 0!==r)return r.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,n),i.exports})(140)})();