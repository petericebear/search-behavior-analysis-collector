(()=>{var e={140:e=>{class t{constructor(e={}){this.config={endpoint:e.endpoint||"/api/track",metricsEndpoint:e.metricsEndpoint||"/api/metrics",selector:e.selector||".trackable-item",dataAttribute:e.dataAttribute||"data-item-id",searchRequestIdAttribute:e.searchRequestIdAttribute||"data-search-request-id",sessionTimeout:e.sessionTimeout||18e5,batchSize:e.batchSize||10,sendInterval:e.sendInterval||1e4,sessionId:e.sessionId||null,searchRequestId:e.searchRequestId||null,bearerToken:e.bearerToken||null,performanceMetricsEnabled:!1!==e.performanceMetricsEnabled},this.events=[],this.performanceMetrics=[],this.sessionId=this.getOrCreateSessionId(),this.browserInfo=this.getBrowserInfo(),this.colorIdentifier=this.getOrCreateColorIdentifier(),this.utmParams=this.getUtmParameters(),this.currentPath=window.location.pathname,this.setupEventListeners(),this.config.performanceMetricsEnabled&&this.setupPerformanceObserver(),this._sessionInterval=setInterval((()=>this.checkSessionExpiration()),6e4),this._batchInterval=setInterval((()=>{this.events.length>0&&this.sendEvents()}),this.config.sendInterval)}getBrowserInfo(){const e=navigator.userAgent,t={userAgent:e,language:navigator.language,platform:navigator.platform,screenWidth:window.screen.width,screenHeight:window.screen.height,viewportWidth:window.innerWidth,viewportHeight:window.innerHeight,devicePixelRatio:window.devicePixelRatio,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:(new Date).toISOString(),domain:window.location.hostname,path:window.location.pathname,connection:navigator.connection?{effectiveType:navigator.connection.effectiveType,downlink:navigator.connection.downlink,rtt:navigator.connection.rtt,saveData:navigator.connection.saveData}:null,memory:navigator.deviceMemory?{deviceMemory:navigator.deviceMemory,hardwareConcurrency:navigator.hardwareConcurrency}:null};return e.includes("Chrome")?t.browser="Chrome":e.includes("Firefox")?t.browser="Firefox":e.includes("Safari")?t.browser="Safari":e.includes("Edge")?t.browser="Edge":t.browser="Unknown",t}setupPerformanceObserver(){if(this._observers&&this._observers.forEach((e=>e.disconnect())),this._observers=[],"PerformanceObserver"in window){const e=new PerformanceObserver((e=>{const t=e.getEntries(),s=t[t.length-1];this.trackPerformanceMetric({type:"LCP",value:s.startTime,element:s.element?.tagName||"unknown",size:s.size,url:s.url})}));e.observe({entryTypes:["largest-contentful-paint"]}),this._observers.push(e);const t=new PerformanceObserver((e=>{const t=e.getEntries();this.trackPerformanceMetric({type:"FCP",value:t[0].startTime})}));t.observe({entryTypes:["paint"]}),this._observers.push(t);const s=new PerformanceObserver((e=>{e.getEntries().forEach((e=>{this.trackPerformanceMetric({type:"FID",value:e.processingStart-e.startTime,name:e.name})}))}));s.observe({entryTypes:["first-input"]}),this._observers.push(s);const r=new PerformanceObserver((e=>{let t=0;e.getEntries().forEach((e=>{e.hadRecentInput||(t+=e.value)})),this.trackPerformanceMetric({type:"CLS",value:t})}));r.observe({entryTypes:["layout-shift"]}),this._observers.push(r);const n=new PerformanceObserver((e=>{e.getEntries().forEach((e=>{this.trackPerformanceMetric({type:"RESOURCE",name:e.name,duration:e.duration,size:e.transferSize,initiatorType:e.initiatorType})}))}));n.observe({entryTypes:["resource"]}),this._observers.push(n);const i=performance.getEntriesByType("navigation")[0];i&&this.trackPerformanceMetric({type:"NAVIGATION",ttfb:i.responseStart-i.requestStart,domContentLoaded:i.domContentLoadedEventEnd-i.startTime,load:i.loadEventEnd-i.startTime,dns:i.domainLookupEnd-i.domainLookupStart,tcp:i.connectEnd-i.connectStart,request:i.responseEnd-i.requestStart})}}trackPerformanceMetric(e){this.performanceMetrics.push({...e,timestamp:(new Date).toISOString(),sessionId:this.sessionId}),this.sendPerformanceMetrics()}async sendPerformanceMetrics(){if(0===this.performanceMetrics.length)return;const e=[...this.performanceMetrics];this.performanceMetrics=[];const t={performanceMetrics:e,sessionId:this.sessionId,colorIdentifier:this.colorIdentifier,browserInfo:this.browserInfo,timestamp:(new Date).toISOString()};try{const s={"Content-Type":"application/json"};this.config.bearerToken&&(s.Authorization=`Bearer ${this.config.bearerToken}`);if(!(await fetch(`${this.config.metricsEndpoint}`,{method:"POST",headers:s,body:JSON.stringify(t)})).ok)throw this.performanceMetrics=[...e,...this.performanceMetrics],new Error("Failed to send performance metrics")}catch(t){console.error("Error sending performance metrics:",t),this.performanceMetrics=[...e,...this.performanceMetrics]}}getOrCreateSessionId(){if(this.config.sessionId)return console.log("[DEBUG] Using injected sessionId, setting localStorage:",typeof localStorage,localStorage),localStorage.setItem("tracker_session_id",this.config.sessionId),localStorage.setItem("tracker_session_timestamp",(new Date).toISOString()),this.config.sessionId;const e=localStorage.getItem("tracker_session_id"),t=localStorage.getItem("tracker_session_timestamp");if(e&&t){if((new Date).getTime()-new Date(t).getTime()<this.config.sessionTimeout)return console.log("[DEBUG] Using existing sessionId:",e),e}const s=this.generateUUID();return console.log("[DEBUG] Creating new session, setting localStorage:",typeof localStorage,localStorage),localStorage.setItem("tracker_session_id",s),localStorage.setItem("tracker_session_timestamp",(new Date).toISOString()),s}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}setupEventListeners(){document.addEventListener("click",(e=>{const t=e.target.closest(this.config.selector);if(t){const e=t.getAttribute(this.config.dataAttribute);if(e){const s=document.querySelectorAll(this.config.selector),r=Array.from(s).indexOf(t)+1,n=t.getAttribute(this.config.searchRequestIdAttribute)||this.config.searchRequestId;this.trackClick({itemId:e,position:r,searchRequestId:n,timestamp:(new Date).toISOString()})}}})),document.addEventListener("visibilitychange",(()=>{this.trackEvent("visibility_change",{state:document.visibilityState})}));const e=history.pushState,t=history.replaceState;history.pushState=function(t,s,r){e.call(this,t,s,r),this.handlePathChange()}.bind(this),history.replaceState=function(e,s,r){t.call(this,e,s,r),this.handlePathChange()}.bind(this),window.addEventListener("popstate",(()=>{this.handlePathChange()})),window.addEventListener("beforeunload",(()=>{this.sendEvents(!0)}))}handlePathChange(){const e=window.location.pathname;e!==this.currentPath&&(this.currentPath=e,this.browserInfo=this.getBrowserInfo(),this.config.performanceMetricsEnabled&&this.setupPerformanceObserver())}setupBatchSending(){setInterval((()=>{this.events.length>0&&this.sendEvents()}),this.config.sendInterval)}trackEvent(e,t={}){this.events.push({type:"custom_event",name:e,data:t,sessionId:this.sessionId,timestamp:(new Date).toISOString()}),this.events.length>=this.config.batchSize&&this.sendEvents()}trackClick(e){this.events.push({type:"click",...e,sessionId:this.sessionId}),this.events.length>=this.config.batchSize&&this.sendEvents()}async sendEvents(e=!1){if(0===this.events.length)return;const t=[...this.events];this.events=[];const s={events:t,sessionId:this.sessionId,colorIdentifier:this.colorIdentifier,browserInfo:this.browserInfo,utmParams:this.utmParams,timestamp:(new Date).toISOString()};try{if(e&&navigator.sendBeacon){if(!navigator.sendBeacon(this.config.endpoint,new Blob([JSON.stringify(s)],{type:"application/json"})))throw this.events=[...t,...this.events],new Error("Failed to send events via sendBeacon")}else{const e={"Content-Type":"application/json"};this.config.bearerToken&&(e.Authorization=`Bearer ${this.config.bearerToken}`);const r=await fetch(this.config.endpoint,{method:"POST",headers:e,body:JSON.stringify(s)});if(!r.ok)throw this.events=[...t,...this.events],new Error("Failed to send events");try{await r.json()}catch(e){console.error("Error sending events:",e),this.events=[...t,...this.events]}}}catch(e){console.error("Error sending events:",e),this.events=[...t,...this.events]}}resetSession(){localStorage.removeItem("tracker_session_id"),localStorage.removeItem("tracker_session_timestamp"),this.sessionId=this.getOrCreateSessionId()}checkSessionExpiration(){const e=localStorage.getItem("tracker_session_timestamp");if(e){(new Date).getTime()-new Date(e).getTime()>=this.config.sessionTimeout&&this.resetSession()}}trackConversion(e){this.trackEvent("conversion",e),this.resetSession()}getOrCreateColorIdentifier(){let e=localStorage.getItem("colorschema_identifier");if(!e){e=`${this.generateRandomColor()}-${this.generateRandomColor()}`,localStorage.setItem("colorschema_identifier",e)}return e}generateRandomColor(){let e="#";for(let t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}getUtmParameters(){const e=new URLSearchParams(window.location.search),t={};return["source","medium","campaign","term","content"].forEach((s=>{const r=e.get(`utm_${s}`);r&&(t[`utm_${s}`]=r)})),t}updateSearchRequestId(e){this.config.searchRequestId=e}destroy(){this._sessionInterval&&clearInterval(this._sessionInterval),this._batchInterval&&clearInterval(this._batchInterval),this._observers&&this._observers.forEach((e=>e.disconnect())),history.pushState!==this.originalPushState&&(history.pushState=this.originalPushState),history.replaceState!==this.originalReplaceState&&(history.replaceState=this.originalReplaceState)}}e.exports?e.exports=t:window.SearchBehaviorAnalysisCollector=t}},t={};(function s(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,s),i.exports})(140)})();